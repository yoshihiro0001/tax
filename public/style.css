/* ============================================
   Keihi v2 — Design System
   圧倒的にシンプルで気持ちいいUI
   ============================================ */

:root {
  --pri: #6366f1;
  --pri-light: #818cf8;
  --pri-bg: #eef2ff;
  --green: #22c55e;
  --green-bg: #f0fdf4;
  --red: #ef4444;
  --red-bg: #fef2f2;
  --bg: #f8fafc;
  --card: #ffffff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text2: #475569;
  --text3: #94a3b8;
  --radius: 16px;
  --radius-sm: 12px;
  --radius-xs: 8px;
  --shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
  --shadow-md: 0 4px 12px rgba(0,0,0,.08);
  --shadow-lg: 0 10px 30px rgba(0,0,0,.12);
  --font: 'Inter', 'Noto Sans JP', -apple-system, sans-serif;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { font-family: var(--font); background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
body { min-height: 100dvh; }
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

/* ============================================
   認証画面
   ============================================ */
#auth-screen {
  display: flex; align-items: center; justify-content: center;
  min-height: 100dvh; padding: 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  animation: auth-bg 8s ease infinite alternate;
}
@keyframes auth-bg { 0%{background-position:0 50%} 100%{background-position:100% 50%} }

.auth-card {
  background: rgba(255,255,255,.95); backdrop-filter: blur(20px);
  border-radius: 24px; padding: 48px 32px 36px; text-align: center;
  width: 100%; max-width: 380px;
  box-shadow: 0 20px 60px rgba(0,0,0,.15);
  animation: card-up .6s cubic-bezier(.22,1,.36,1);
}
@keyframes card-up { from { opacity: 0; transform: translateY(30px) scale(.96); } }

.auth-logo {
  width: 64px; height: 64px; margin: 0 auto 12px;
  background: var(--pri); color: #fff; border-radius: 18px;
  display: flex; align-items: center; justify-content: center;
  font-size: 28px; font-weight: 800;
  box-shadow: 0 4px 20px rgba(99,102,241,.35);
}
.auth-title { font-size: 26px; font-weight: 800; margin-bottom: 4px; color: var(--text); }
.auth-sub { color: var(--text3); font-size: 14px; margin-bottom: 28px; }

.auth-form input {
  width: 100%; padding: 14px 16px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: 15px; font-family: var(--font); margin-bottom: 12px; outline: none;
  transition: border-color .2s, box-shadow .2s;
}
.auth-form input:focus { border-color: var(--pri); box-shadow: 0 0 0 3px rgba(99,102,241,.12); }

.btn-auth {
  width: 100%; padding: 15px; border: none; border-radius: var(--radius-sm);
  background: var(--pri); color: #fff; font-size: 16px; font-weight: 600;
  font-family: var(--font); cursor: pointer; transition: all .2s;
}
.btn-auth:active { transform: scale(.97); }

/* Google ログインボタン */
.google-btn-wrap { display: flex; justify-content: center; margin-bottom: 0; }
.auth-divider {
  display: flex; align-items: center; gap: 12px; margin: 20px 0;
  color: var(--text3); font-size: 12px;
}
.auth-divider::before, .auth-divider::after {
  content: ''; flex: 1; height: 1px; background: var(--border);
}

.auth-toggle { margin-top: 20px; font-size: 13px; color: var(--text3); }
.auth-toggle a { color: var(--pri); font-weight: 600; text-decoration: none; margin-left: 6px; }

/* ユーザーアバター画像 */
.user-avatar-img {
  width: 36px; height: 36px; border-radius: 999px; object-fit: cover;
  position: absolute; top: 0; left: 0;
}
.user-btn { position: relative; overflow: hidden; }

/* ============================================
   トップバー
   ============================================ */
.topbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px; padding-top: calc(12px + var(--safe-top));
  background: var(--card); border-bottom: 1px solid var(--border);
  position: sticky; top: 0; z-index: 100;
}
.book-selector {
  display: flex; align-items: center; gap: 6px; padding: 8px 12px;
  border: 1.5px solid var(--border); border-radius: 999px; background: var(--bg);
  font-size: 14px; font-weight: 600; cursor: pointer; font-family: var(--font); color: var(--text);
  transition: all .2s;
}
.book-selector:active { transform: scale(.96); background: var(--border); }
.topbar-logo { font-size: 20px; font-weight: 800; color: var(--pri); }
.user-btn {
  width: 36px; height: 36px; border-radius: 999px; border: none;
  background: var(--pri-bg); color: var(--pri); font-weight: 700; font-size: 14px;
  cursor: pointer; transition: all .2s; font-family: var(--font);
}
.user-btn:active { transform: scale(.92); }

/* ============================================
   メインコンテンツ
   ============================================ */
.app-main {
  padding: 0 0 calc(72px + var(--safe-bottom));
  overflow-y: auto; -webkit-overflow-scrolling: touch;
}
.view { display: none; padding: 20px 16px 24px; animation: view-in .35s cubic-bezier(.22,1,.36,1); }
.view.active { display: block; }
@keyframes view-in { from { opacity: 0; transform: translateY(12px); } }

/* ============================================
   ホーム
   ============================================ */
.home-summary {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;
}
.summary-item {
  padding: 18px 16px; border-radius: var(--radius); background: var(--card);
  box-shadow: var(--shadow); animation: card-pop .4s cubic-bezier(.22,1,.36,1) both;
}
.summary-item:nth-child(2) { animation-delay: .06s; }
.summary-label { display: block; font-size: 12px; color: var(--text3); font-weight: 500; margin-bottom: 4px; }
.summary-value { font-size: 22px; font-weight: 800; letter-spacing: -.02em; }
.summary-item.expense .summary-value { color: var(--red); }
.summary-item.income .summary-value { color: var(--green); }
@keyframes card-pop { from { opacity:0; transform: scale(.92) translateY(8px); } }

/* レシート撮影ヒーロー */
.capture-hero {
  display: block; margin-bottom: 16px; cursor: pointer;
  animation: hero-in .5s cubic-bezier(.22,1,.36,1) .1s both;
}
@keyframes hero-in { from { opacity: 0; transform: translateY(16px) scale(.95); } }

.capture-hero-inner {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 12px; padding: 32px 20px; border-radius: 20px;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: #fff; position: relative; overflow: hidden;
  transition: transform .2s; box-shadow: 0 8px 30px rgba(99,102,241,.3);
}
.capture-hero:active .capture-hero-inner { transform: scale(.97); }
.capture-hero-inner svg { width: 40px; height: 40px; stroke-width: 1.5; }
.capture-hero-inner span { font-size: 16px; font-weight: 700; }
.capture-hero-glow {
  position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,.15) 0%, transparent 60%);
  animation: glow-move 3s ease-in-out infinite;
  pointer-events: none;
}
@keyframes glow-move { 0%,100%{transform:translate(0,0)} 50%{transform:translate(30px,-20px)} }

/* サブアクション */
.sub-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 28px; }
.btn-sub {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  padding: 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  background: var(--card); font-size: 14px; font-weight: 600; color: var(--text);
  cursor: pointer; font-family: var(--font); transition: all .15s;
}
.btn-sub:active { transform: scale(.96); background: var(--bg); }

.section-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.section-head h2 { font-size: 16px; font-weight: 700; }
.link-btn { background: none; border: none; color: var(--pri); font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); padding: 4px; }

/* 取引リスト */
.tx-list { display: flex; flex-direction: column; gap: 2px; }
.tx-item {
  display: flex; align-items: center; gap: 12px; padding: 14px 12px;
  background: var(--card); border-radius: var(--radius-sm); cursor: pointer;
  transition: background .15s; animation: tx-in .3s cubic-bezier(.22,1,.36,1) both;
  animation-delay: calc(var(--i,0) * .04s);
}
.tx-item:active { background: var(--bg); }
@keyframes tx-in { from { opacity:0; transform: translateX(-8px); } }

.tx-icon {
  width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
  font-size: 18px; flex-shrink: 0;
}
.tx-icon.expense { background: var(--red-bg); }
.tx-icon.income { background: var(--green-bg); }
.tx-info { flex: 1; min-width: 0; }
.tx-desc { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tx-date { font-size: 12px; color: var(--text3); margin-top: 2px; }
.tx-amount { font-size: 15px; font-weight: 700; text-align: right; white-space: nowrap; }
.tx-amount.expense { color: var(--red); }
.tx-amount.income { color: var(--green); }

.empty-msg {
  text-align: center; padding: 40px 20px; color: var(--text3); font-size: 14px;
}

/* ============================================
   レポート
   ============================================ */
.view-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.view-head h1 { font-size: 22px; font-weight: 800; }
.sel-year {
  padding: 8px 12px; border: 1.5px solid var(--border); border-radius: var(--radius-xs);
  background: var(--card); font-size: 14px; font-weight: 600; font-family: var(--font); color: var(--text);
}

.report-summary {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  box-shadow: var(--shadow); margin-bottom: 16px;
}
.rpt-row { display: flex; justify-content: space-between; padding: 10px 0; }
.rpt-row.bold { font-weight: 700; font-size: 16px; }
.rpt-val { font-weight: 700; }
.rpt-val.income { color: var(--green); }
.rpt-val.expense { color: var(--red); }
.rpt-val.primary { color: var(--pri); }
.rpt-div { height: 1px; background: var(--border); }
.rpt-div.thick { height: 2px; background: var(--text); }

.card {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  box-shadow: var(--shadow); margin-bottom: 16px;
}
.card-title { font-size: 15px; font-weight: 700; margin-bottom: 12px; }
.card-desc { font-size: 13px; color: var(--text3); margin-bottom: 12px; }
.chart-wrap { height: 200px; position: relative; }

/* 内訳バー */
.bd-item { margin-bottom: 12px; }
.bd-head { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; }
.bd-name { font-weight: 600; }
.bd-val { color: var(--text2); }
.bd-bar { height: 6px; background: var(--bg); border-radius: 3px; overflow: hidden; }
.bd-fill { height: 100%; border-radius: 3px; background: var(--pri); transition: width .6s cubic-bezier(.22,1,.36,1); }

/* AI */
.ai-textarea {
  width: 100%; min-height: 120px; padding: 12px; border: 1.5px solid var(--border);
  border-radius: var(--radius-xs); font-family: monospace; font-size: 12px; resize: vertical;
  margin-top: 8px; background: var(--bg); color: var(--text);
}

/* ============================================
   設定
   ============================================ */
.book-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
.book-item {
  display: flex; align-items: center; gap: 10px; padding: 14px;
  background: var(--bg); border-radius: var(--radius-sm); border: 1.5px solid transparent;
  transition: all .15s;
}
.book-item.active { border-color: var(--pri); background: var(--pri-bg); }
.book-item-emoji { font-size: 20px; }
.book-item-name { flex: 1; font-size: 14px; font-weight: 600; }
.book-item-actions { display: flex; gap: 4px; }
.book-item-btn {
  width: 32px; height: 32px; border: none; border-radius: 8px; cursor: pointer;
  background: transparent; color: var(--text3); font-size: 16px; display: flex; align-items: center; justify-content: center;
  transition: all .15s;
}
.book-item-btn:hover { background: var(--border); color: var(--text); }
.book-item-btn.danger:hover { background: var(--red-bg); color: var(--red); }

/* ============================================
   データ概要・見える化
   ============================================ */
.overview-loading { display: flex; justify-content: center; padding: 24px; }

.ov-book {
  background: var(--bg); border-radius: var(--radius-sm); padding: 16px;
  margin-bottom: 12px; animation: card-pop .4s cubic-bezier(.22,1,.36,1) both;
}
.ov-book-head { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
.ov-book-emoji { font-size: 22px; }
.ov-book-name { font-size: 15px; font-weight: 700; }
.ov-book-badge { font-size: 11px; padding: 2px 8px; background: var(--pri-bg); color: var(--pri); border-radius: 999px; font-weight: 600; margin-left: auto; }

.ov-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
.ov-stat { text-align: center; }
.ov-stat-val { font-size: 18px; font-weight: 800; display: block; }
.ov-stat-val.income { color: var(--green); }
.ov-stat-val.expense { color: var(--red); }
.ov-stat-val.neutral { color: var(--pri); }
.ov-stat-label { font-size: 11px; color: var(--text3); }

.ov-cats { display: flex; flex-direction: column; gap: 6px; }
.ov-cat-row { display: flex; align-items: center; gap: 8px; font-size: 12px; }
.ov-cat-name { width: 80px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ov-cat-bar { flex: 1; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
.ov-cat-fill { height: 100%; border-radius: 3px; background: var(--pri); transition: width .6s cubic-bezier(.22,1,.36,1); }
.ov-cat-val { width: 70px; text-align: right; color: var(--text2); font-weight: 500; }
.ov-date-range { font-size: 11px; color: var(--text3); text-align: center; margin-top: 8px; }

.ov-storage {
  background: var(--bg); border-radius: var(--radius-sm); padding: 16px; margin-top: 4px;
}
.ov-storage-title { font-size: 13px; font-weight: 700; margin-bottom: 10px; }
.ov-storage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.ov-storage-item { text-align: center; padding: 10px; background: var(--card); border-radius: var(--radius-xs); }
.ov-storage-val { font-size: 16px; font-weight: 800; display: block; color: var(--text); }
.ov-storage-label { font-size: 11px; color: var(--text3); }

/* ============================================
   ユーザー問い合わせ
   ============================================ */
.my-inq-list { display: flex; flex-direction: column; gap: 10px; }
.my-inq-item { padding: 12px; background: var(--bg); border-radius: var(--radius-xs); }
.my-inq-head { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 4px; }
.my-inq-subject { font-size: 13px; font-weight: 600; color: var(--text); }
.my-inq-status {
  font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 999px; white-space: nowrap;
}
.my-inq-status.st-new { background: var(--red-bg); color: var(--red); }
.my-inq-status.st-progress { background: #fef3c7; color: #d97706; }
.my-inq-status.st-replied { background: var(--green-bg); color: var(--green); }
.my-inq-status.st-resolved { background: var(--pri-bg); color: var(--pri); }
.my-inq-msg { font-size: 12px; color: var(--text2); line-height: 1.4; }
.my-inq-reply { font-size: 12px; color: var(--pri); background: var(--pri-bg); padding: 8px; border-radius: 6px; margin-top: 6px; line-height: 1.4; }
.my-inq-date { font-size: 10px; color: var(--text3); margin-top: 4px; }

/* ============================================
   管理者運用パネル
   ============================================ */
.admin-divider {
  display: flex; align-items: center; gap: 12px; margin: 28px 0 16px;
  color: var(--pri); font-size: 14px; font-weight: 700; letter-spacing: .5px;
}
.admin-divider::before, .admin-divider::after {
  content: ''; flex: 1; height: 2px;
  background: linear-gradient(90deg, transparent, var(--pri), transparent);
}

.admin-section { margin-bottom: 16px; }
.admin-section-title { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 10px; }

/* システムステータスカード */
.admin-status-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
.admin-st-card {
  display: flex; align-items: center; gap: 10px;
  background: var(--card); border-radius: var(--radius-sm); padding: 14px;
  box-shadow: var(--shadow); animation: card-pop .35s cubic-bezier(.22,1,.36,1) both;
}
.admin-st-card.st-ok { border-left: 3px solid var(--green); }
.admin-st-card.st-warn { border-left: 3px solid #f59e0b; }
.admin-st-card.st-error { border-left: 3px solid var(--red); }
.admin-st-icon { font-size: 22px; flex-shrink: 0; }
.admin-st-info { display: flex; flex-direction: column; min-width: 0; }
.admin-st-val { font-size: 16px; font-weight: 800; color: var(--text); white-space: nowrap; }
.admin-st-val.val-red { color: var(--red); }
.admin-st-label { font-size: 10px; color: var(--text3); font-weight: 500; }

/* 運用KPIグリッド */
.admin-kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.admin-kpi-item {
  text-align: center; padding: 12px 8px; background: var(--card); border-radius: var(--radius-xs);
  box-shadow: var(--shadow); animation: card-pop .3s both;
}
.admin-kpi-num { font-size: 22px; font-weight: 800; display: block; color: var(--text); line-height: 1.2; }
.admin-kpi-num.kpi-green { color: var(--green); }
.admin-kpi-num.kpi-blue { color: #3b82f6; }
.admin-kpi-num.kpi-purple { color: #8b5cf6; }
.admin-kpi-num.kpi-gold { color: #d97706; }
.admin-kpi-label { font-size: 10px; color: var(--text3); font-weight: 500; margin-top: 2px; display: block; }

/* DAUチャート */
.admin-chart-wrap { height: 180px; position: relative; }

/* カードヘッダ (タイトル + バッジ) */
.admin-card-head { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
.admin-card-head .card-title { margin-bottom: 0; }
.admin-badge-count {
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 22px; height: 22px; padding: 0 6px; border-radius: 999px;
  font-size: 11px; font-weight: 700; background: var(--bg); color: var(--text3);
}
.admin-badge-count.admin-badge-new { background: var(--red); color: #fff; animation: pulse-badge .8s ease infinite; }
@keyframes pulse-badge { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }

/* ログリスト */
.admin-log-list { display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto; }
.admin-log-item {
  padding: 10px 12px; background: var(--bg); border-radius: var(--radius-xs);
  font-size: 12px; border-left: 3px solid var(--border);
}
.admin-log-item.log-error { border-left-color: var(--red); background: #fef2f2; }
.admin-log-head { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
.admin-log-icon { font-size: 14px; }
.admin-log-time { font-size: 10px; color: var(--text3); font-family: monospace; font-weight: 600; }
.admin-log-endpoint { font-size: 10px; color: var(--pri); background: var(--pri-bg); padding: 1px 6px; border-radius: 4px; }
.admin-log-msg { color: var(--text); line-height: 1.4; word-break: break-word; }
.admin-log-user { font-size: 10px; color: var(--text3); margin-top: 2px; }

/* 問い合わせリスト */
.admin-inquiry-list { display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; }
.admin-inq-item {
  padding: 12px; background: var(--bg); border-radius: var(--radius-xs); cursor: pointer;
  transition: background .2s, box-shadow .2s;
}
.admin-inq-item:hover { background: var(--pri-bg); box-shadow: var(--shadow); }
.admin-inq-head { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.admin-inq-status-icon { font-size: 12px; }
.admin-inq-subject { font-size: 13px; font-weight: 600; flex: 1; }
.admin-inq-st { font-size: 10px; color: var(--text3); font-weight: 600; }
.admin-inq-from { font-size: 11px; color: var(--pri); font-weight: 500; margin-bottom: 3px; }
.admin-inq-msg { font-size: 12px; color: var(--text2); line-height: 1.4; }
.admin-inq-date { font-size: 10px; color: var(--text3); margin-top: 4px; }

/* 管理者返信モーダル */
.admin-reply-detail { padding: 12px; background: var(--bg); border-radius: var(--radius-xs); margin-bottom: 16px; }
.admin-reply-from { font-size: 13px; margin-bottom: 8px; }
.admin-reply-date { font-size: 11px; color: var(--text3); }
.admin-reply-msg { font-size: 13px; color: var(--text); line-height: 1.5; white-space: pre-wrap; }

/* 空状態 */
.admin-empty { text-align: center; padding: 20px; font-size: 13px; color: var(--text3); }

/* ユーザー管理行 */
.au-item {
  display: flex; align-items: center; gap: 10px; padding: 14px 0;
  border-bottom: 1px solid var(--border); animation: tx-in .3s both;
}
.au-item:last-child { border-bottom: none; }
.au-avatar {
  width: 36px; height: 36px; border-radius: 999px; background: var(--pri-bg); color: var(--pri);
  display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;
  flex-shrink: 0; overflow: hidden;
}
.au-avatar-img { width: 100%; height: 100%; object-fit: cover; border-radius: 999px; }
.au-avatar-letter { font-size: 14px; font-weight: 700; }
.au-info { flex: 1; min-width: 0; }
.au-name { font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
.au-role-badge {
  font-size: 9px; font-weight: 700; padding: 1px 6px; border-radius: 999px;
}
.au-role-admin { background: var(--pri-bg); color: var(--pri); }
.au-role-user { background: var(--bg); color: var(--text3); }
.au-email { font-size: 11px; color: var(--text3); }
.au-stats { font-size: 11px; color: var(--text2); margin-top: 2px; }
.au-controls { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
.au-select {
  padding: 4px 6px; border: 1px solid var(--border); border-radius: 6px;
  font-size: 11px; font-family: var(--font); background: var(--card); color: var(--text);
  cursor: pointer;
}
.au-select:focus { border-color: var(--pri); }

/* ストレージバー */
.storage-bar-wrap { margin-bottom: 12px; }
.storage-bar-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; }
.storage-bar-name { font-weight: 600; }
.storage-bar-val { color: var(--text2); }
.storage-bar { height: 8px; background: var(--bg); border-radius: 4px; overflow: hidden; }
.storage-bar-fill { height: 100%; border-radius: 4px; transition: width .6s cubic-bezier(.22,1,.36,1); }
.storage-bar-fill.db { background: var(--pri); }
.storage-bar-fill.img { background: var(--green); }

/* ============================================
   取引履歴ビュー
   ============================================ */
.filter-bar {
  display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;
}
.sel-sm {
  padding: 8px 10px; border: 1.5px solid var(--border); border-radius: var(--radius-xs);
  background: var(--card); font-size: 13px; font-family: var(--font); color: var(--text);
}

/* ============================================
   ボトムナビ
   ============================================ */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 100;
  display: flex; background: var(--card); border-top: 1px solid var(--border);
  padding-bottom: var(--safe-bottom);
}
.bnav-item {
  flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px;
  padding: 10px 0 8px; border: none; background: none;
  font-size: 10px; font-weight: 600; color: var(--text3); cursor: pointer;
  font-family: var(--font); transition: color .2s;
}
.bnav-item svg { width: 22px; height: 22px; transition: all .2s; }
.bnav-item.active { color: var(--pri); }
.bnav-item.active svg { stroke-width: 2.5; }
.bnav-item:active { opacity: .7; }

/* ============================================
   オーバーレイ / モーダル
   ============================================ */
.overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,.4); backdrop-filter: blur(4px);
  display: flex; align-items: flex-end; justify-content: center;
  animation: overlay-in .25s ease;
}
@keyframes overlay-in { from { opacity: 0; } }

.modal-sheet {
  background: var(--card); border-radius: 24px 24px 0 0; padding: 24px 20px;
  padding-bottom: calc(24px + var(--safe-bottom));
  width: 100%; max-width: 500px; max-height: 90dvh; overflow-y: auto;
  animation: sheet-up .3s cubic-bezier(.22,1,.36,1);
}
.modal-sheet.modal-sm { max-width: 400px; }
.modal-sheet.modal-wide { max-width: 600px; }
@keyframes sheet-up { from { transform: translateY(100%); } }

.modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.modal-head h3 { font-size: 18px; font-weight: 700; }
.btn-close { width: 32px; height: 32px; border: none; border-radius: 999px; background: var(--bg); font-size: 20px; cursor: pointer; color: var(--text3); display: flex; align-items: center; justify-content: center; }

.modal-form { display: flex; flex-direction: column; gap: 16px; }
.fg { display: flex; flex-direction: column; gap: 6px; }
.fg label { font-size: 13px; font-weight: 600; color: var(--text2); }
.fi {
  width: 100%; padding: 13px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: 15px; font-family: var(--font); outline: none; transition: all .2s; background: var(--card); color: var(--text);
}
.fi:focus { border-color: var(--pri); box-shadow: 0 0 0 3px rgba(99,102,241,.1); }
.fi-amt { position: relative; display: flex; align-items: center; }
.fi-amt span { position: absolute; left: 14px; font-size: 15px; font-weight: 600; color: var(--text3); }
.fi-amt .fi { padding-left: 28px; }

.modal-btns { display: flex; gap: 10px; padding-top: 4px; }
.modal-btns .btn-save { flex: 1; }

/* ============================================
   スキャン
   ============================================ */
#overlay-scanning { align-items: center; justify-content: center; }
.scan-wrap {
  width: 90%; max-width: 360px; background: var(--card); border-radius: 24px;
  padding: 24px; overflow: hidden; animation: sheet-up .3s cubic-bezier(.22,1,.36,1);
}
.scan-img-wrap {
  position: relative; border-radius: var(--radius); overflow: hidden; aspect-ratio: 3/4;
  background: #1e293b; margin-bottom: 20px;
}
.scan-img-wrap img { width: 100%; height: 100%; object-fit: cover; opacity: .7; }
.scan-line {
  position: absolute; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, transparent, var(--pri), transparent);
  box-shadow: 0 0 20px var(--pri); animation: scan-sweep 2s ease-in-out infinite;
}
@keyframes scan-sweep { 0%{top:0} 50%{top:100%} 100%{top:0} }
.scan-corners span {
  position: absolute; width: 24px; height: 24px;
  border: 3px solid var(--pri); animation: corner-flash 1.5s ease-in-out infinite;
}
.sc.tl { top: 8px; left: 8px; border-right: none; border-bottom: none; border-radius: 4px 0 0 0; }
.sc.tr { top: 8px; right: 8px; border-left: none; border-bottom: none; border-radius: 0 4px 0 0; }
.sc.bl { bottom: 8px; left: 8px; border-right: none; border-top: none; border-radius: 0 0 0 4px; }
.sc.br { bottom: 8px; right: 8px; border-left: none; border-top: none; border-radius: 0 0 4px 0; }
@keyframes corner-flash { 0%,100%{opacity:.6} 50%{opacity:1} }

.scan-info { text-align: center; }
.scan-badge {
  display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px;
  background: var(--pri-bg); color: var(--pri); border-radius: 999px;
  font-size: 13px; font-weight: 600; margin-bottom: 12px;
}
.scan-dot { width: 8px; height: 8px; background: var(--pri); border-radius: 999px; animation: dot-blink 1s ease infinite; }
@keyframes dot-blink { 0%,100%{opacity:.4} 50%{opacity:1} }
.scan-progress { height: 4px; background: var(--bg); border-radius: 2px; overflow: hidden; }
.scan-progress-fill { height: 100%; background: var(--pri); border-radius: 2px; width: 0; transition: width .3s; }

/* ============================================
   確認シート
   ============================================ */
#overlay-confirm { align-items: flex-end; }
.confirm-sheet {
  background: var(--card); border-radius: 24px 24px 0 0; padding: 24px 20px;
  padding-bottom: calc(24px + var(--safe-bottom));
  width: 100%; max-width: 500px; max-height: 90dvh; overflow-y: auto;
  animation: sheet-up .35s cubic-bezier(.22,1,.36,1);
}
.confirm-head { margin-bottom: 20px; }
.confirm-badge {
  display: inline-block; padding: 4px 12px; background: var(--green-bg); color: var(--green);
  border-radius: 999px; font-size: 13px; font-weight: 600; margin-bottom: 8px;
  animation: badge-pop .4s cubic-bezier(.22,1,.36,1) .2s both;
}
@keyframes badge-pop { from { opacity:0; transform: scale(.5); } }
.confirm-head h2 { font-size: 20px; font-weight: 800; }

.confirm-body { display: flex; flex-direction: column; gap: 16px; }
.confirm-thumb-wrap {
  height: 100px; border-radius: var(--radius-sm); overflow: hidden; background: var(--bg);
}
.confirm-thumb-wrap img { width: 100%; height: 100%; object-fit: cover; }

.confirm-fields { display: flex; flex-direction: column; gap: 14px; }
.cf {
  display: flex; flex-direction: column; gap: 6px;
  animation: cf-slide .35s cubic-bezier(.22,1,.36,1) both;
  animation-delay: calc(var(--i) * .06s + .15s);
}
@keyframes cf-slide { from { opacity: 0; transform: translateY(12px); } }
.cf label { font-size: 12px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: .5px; }
.cf-input {
  padding: 12px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: 15px; font-family: var(--font); outline: none; width: 100%;
  transition: all .2s; color: var(--text); background: var(--card);
}
.cf-input:focus { border-color: var(--pri); box-shadow: 0 0 0 3px rgba(99,102,241,.1); }
.cf-input-big { font-size: 22px; font-weight: 700; }
.cf-amt { position: relative; display: flex; align-items: center; }
.cf-amt span { position: absolute; left: 14px; font-size: 20px; font-weight: 700; color: var(--text3); }
.cf-amt .cf-input { padding-left: 30px; }

.cf-cats { display: flex; flex-wrap: wrap; gap: 8px; }
.cf-chip {
  padding: 8px 14px; border: 1.5px solid var(--border); border-radius: 999px;
  font-size: 13px; font-weight: 500; cursor: pointer; background: var(--card);
  transition: all .15s; white-space: nowrap; font-family: var(--font); color: var(--text);
}
.cf-chip:active { transform: scale(.95); }
.cf-chip.active {
  background: var(--pri); border-color: var(--pri); color: #fff;
  animation: chip-pop .2s cubic-bezier(.22,1,.36,1);
}
@keyframes chip-pop { 50% { transform: scale(1.06); } }

.confirm-actions { display: flex; gap: 10px; margin-top: 24px; }
.confirm-actions button { flex: 1; }

/* ============================================
   成功画面
   ============================================ */
#overlay-success { align-items: center; justify-content: center; background: rgba(0,0,0,.6); }
.success-sheet {
  text-align: center; padding: 48px 32px; position: relative;
  animation: success-in .4s cubic-bezier(.22,1,.36,1);
}
@keyframes success-in { from { opacity: 0; transform: scale(.8); } }

.success-particles { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
.success-particle {
  position: absolute; width: 8px; height: 8px; border-radius: 2px;
  animation: confetti-fall 1.5s ease-out forwards;
}
@keyframes confetti-fall {
  0% { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
  100% { opacity: 0; transform: translateY(200px) rotate(720deg) scale(0); }
}

.success-check-wrap { margin-bottom: 16px; }
.success-checkmark { width: 72px; height: 72px; }
.success-circle { stroke: var(--green); stroke-width: 2; stroke-dasharray: 157; stroke-dashoffset: 157; animation: circle-draw .5s ease .1s forwards; }
.success-path { stroke: var(--green); stroke-width: 3; stroke-dasharray: 48; stroke-dashoffset: 48; animation: check-draw .3s ease .5s forwards; }
@keyframes circle-draw { to { stroke-dashoffset: 0; } }
@keyframes check-draw { to { stroke-dashoffset: 0; } }

.success-title { font-size: 22px; font-weight: 800; color: #fff; margin-bottom: 6px; animation: succ-t .4s .3s both; }
.success-summary { color: rgba(255,255,255,.7); font-size: 14px; margin-bottom: 28px; animation: succ-t .4s .4s both; }
@keyframes succ-t { from { opacity:0; transform: translateY(10px); } }
.success-actions { display: flex; gap: 10px; justify-content: center; animation: succ-t .4s .5s both; }
.success-actions .btn-save { background: #fff; color: var(--pri); }
.success-actions .btn-outline { border-color: rgba(255,255,255,.3); color: #fff; }

/* ============================================
   共通ボタン
   ============================================ */
.btn-save {
  padding: 14px 24px; border: none; border-radius: var(--radius-sm);
  background: var(--pri); color: #fff; font-size: 15px; font-weight: 600;
  font-family: var(--font); cursor: pointer; transition: all .15s;
}
.btn-save:active { transform: scale(.97); opacity: .9; }
.btn-save:disabled { opacity: .5; cursor: default; }
.btn-outline {
  padding: 14px 24px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  background: var(--card); color: var(--text); font-size: 15px; font-weight: 600;
  font-family: var(--font); cursor: pointer; transition: all .15s;
}
.btn-outline:active { transform: scale(.97); background: var(--bg); }
.btn-primary { background: var(--pri); color: #fff; border: none; border-radius: var(--radius-sm); padding: 10px 16px; font-size: 14px; font-weight: 600; font-family: var(--font); cursor: pointer; }
.btn-primary:active { transform: scale(.97); }
.btn-danger { padding: 14px; border: none; border-radius: var(--radius-sm); background: var(--red-bg); color: var(--red); font-size: 15px; font-weight: 600; font-family: var(--font); cursor: pointer; transition: all .15s; }
.btn-danger:active { transform: scale(.97); }
.btn-full { width: 100%; }
.btn-sm { padding: 8px 14px; font-size: 13px; }

/* ============================================
   カテゴリチップ
   ============================================ */
.cat-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.cat-chip {
  padding: 8px 12px; border: 1.5px solid var(--border); border-radius: 999px;
  font-size: 13px; cursor: pointer; background: var(--card); transition: all .15s;
  white-space: nowrap; font-family: var(--font); color: var(--text);
}
.cat-chip:active { transform: scale(.95); }
.cat-chip.active { background: var(--pri); border-color: var(--pri); color: #fff; }

/* ============================================
   帳簿選択
   ============================================ */
.book-select-list { display: flex; flex-direction: column; gap: 4px; }
.book-select-item {
  display: flex; align-items: center; gap: 10px; padding: 14px 12px;
  border-radius: var(--radius-sm); cursor: pointer; transition: all .15s; border: 1.5px solid transparent;
}
.book-select-item:active { background: var(--bg); }
.book-select-item.active { background: var(--pri-bg); border-color: var(--pri); }
.book-select-emoji { font-size: 20px; }
.book-select-name { font-size: 15px; font-weight: 600; }

/* ============================================
   CSV
   ============================================ */
.file-area { text-align: center; padding: 24px; }
.file-label {
  display: inline-block; padding: 14px 28px; border: 2px dashed var(--border); border-radius: var(--radius);
  font-size: 14px; font-weight: 600; color: var(--pri); cursor: pointer; transition: all .15s;
}
.file-label:active { transform: scale(.97); background: var(--pri-bg); }
.csv-loading { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 20px; color: var(--text3); font-size: 14px; }
.spinner { width: 20px; height: 20px; border: 3px solid var(--border); border-top-color: var(--pri); border-radius: 50%; animation: spin .6s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.csv-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 14px; font-weight: 600; }
.csv-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 12px; }
.csv-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.csv-table th { text-align: left; padding: 10px 8px; background: var(--bg); font-weight: 600; color: var(--text2); position: sticky; top: 0; white-space: nowrap; }
.csv-table td { padding: 10px 8px; border-bottom: 1px solid var(--border); white-space: nowrap; }
.csv-th-ck { width: 32px; }
.csv-cat-sel { padding: 6px 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; font-family: var(--font); background: var(--card); }
.csv-foot { display: flex; justify-content: space-between; align-items: center; font-size: 13px; }

/* Emoji picker */
.emoji-picker { display: flex; flex-wrap: wrap; gap: 8px; }
.ep {
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
  border: 1.5px solid var(--border); border-radius: 10px; font-size: 20px; cursor: pointer;
  transition: all .15s; background: var(--card);
}
.ep:active { transform: scale(.9); }
.ep.selected { border-color: var(--pri); background: var(--pri-bg); }

/* ============================================
   トースト
   ============================================ */
#toast-container {
  position: fixed; top: calc(16px + var(--safe-top)); left: 50%;
  transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 8px;
  pointer-events: none;
}
.toast {
  padding: 12px 20px; border-radius: 999px; font-size: 14px; font-weight: 600;
  background: var(--text); color: #fff; box-shadow: var(--shadow-lg);
  animation: toast-in .3s cubic-bezier(.22,1,.36,1); white-space: nowrap;
}
.toast.error { background: var(--red); }
.toast.success { background: var(--green); }
.toast.out { animation: toast-out .25s ease forwards; }
@keyframes toast-in { from { opacity: 0; transform: translateY(-10px) scale(.9); } }
@keyframes toast-out { to { opacity: 0; transform: translateY(-10px) scale(.9); } }

/* ============================================
   レスポンシブ
   ============================================ */
@media (min-width: 600px) {
  .modal-sheet, .confirm-sheet { border-radius: 24px; margin-bottom: 24px; }
  .overlay { align-items: center; }
  .scan-wrap { border-radius: 24px; }
}

@media (min-width: 768px) {
  .app-main { max-width: 600px; margin: 0 auto; }
  .topbar { max-width: 600px; margin: 0 auto; }
}

/* Print */
@media print { .topbar, .bottom-nav, .overlay { display: none !important; } }
